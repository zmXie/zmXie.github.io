(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[28],{

/***/ 588:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/@vuepress/core/node_modules/.cache/vuepress","cacheIdentifier":"18d1decd-vue-loader-template"}!./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--1-0!./node_modules/vue-loader/lib??ref--1-1!./node_modules/@vuepress/markdown-loader??ref--1-2!./blogs/frontEnd/20210417-js-thread.md?vue&type=template&id=e0b74eec&
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContentSlotsDistributor',{attrs:{"slot-key":_vm.$parent.slotKey}},[_c('p',[_vm._v("众所周知，JavaScript 是单线程的，那么执行 Ajax 请求 、 setTimeout 定时器等异步操作，为啥不会阻塞线程？因为运行环境是多线程的，比如在浏览器中，http 请求、定时器都有单独的线程处理，完成之后再把回调函数加入到事件队列中等待主线程执行。")]),_vm._v(" "),_c('h3',{attrs:{"id":"浏览器中的线程"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#浏览器中的线程"}},[_vm._v("#")]),_vm._v(" 浏览器中的线程")]),_vm._v(" "),_c('p',[_vm._v("浏览器是 JavaScript 的一个运行环境，每一个 tab 页签都是一个进程，而每一个进程里面都有几个常驻线程：")]),_vm._v(" "),_c('ul',[_c('li',[_c('strong',[_vm._v("GUI 渲染线程")]),_vm._v("：负责解析 html、css，构建 DOM 树，布局和绘制。")]),_vm._v(" "),_c('li',[_c('strong',[_vm._v("JS 引擎线程")]),_vm._v("：负责解析执行 JS 代码，与 GUI 渲染线程互斥。")]),_vm._v(" "),_c('li',[_c('strong',[_vm._v("事件触发线程")]),_vm._v("：负责控制事件循环，比如 ajax，定时器，鼠标 click。")]),_vm._v(" "),_c('li',[_c('strong',[_vm._v("http 请求线程")]),_vm._v("：负责处理 ajax 网络请求。")]),_vm._v(" "),_c('li',[_c('strong',[_vm._v("定时器线程")]),_vm._v("：负责定时器处理。")])]),_vm._v(" "),_c('h3',{attrs:{"id":"webworker"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#webworker"}},[_vm._v("#")]),_vm._v(" WebWorker")]),_vm._v(" "),_c('p',[_vm._v("WebWorker 属于 HTML5 规范范畴，为 JS 提供了多线程解决方案，可以开辟后台线程来运行 JS，但这仍然是运行环境的线程，属于 Web API（浏览器的接口） ，不属于 ES 规范范畴，所以说 JS 是单线程，归根结底是因为 JS 是基于单线程设计的， 没有提供多线程 API。")]),_vm._v(" "),_c('ul',[_c('li',[_c('p',[_vm._v("基本用法")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("调用"),_c('code',[_vm._v("worker()")]),_vm._v("构造函数，传入 js 文件名，创建 一个 worker 对象。")])]),_vm._v(" "),_c('div',{staticClass:"language-js line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-js"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 主线程")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("let")]),_vm._v(" worker "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("new")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token class-name"}},[_vm._v("Worker")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token string"}},[_vm._v("'work.js'")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br')])]),_c('ol',{attrs:{"start":"2"}},[_c('li',[_vm._v("通过"),_c('code',[_vm._v("postMessage")]),_vm._v("与"),_c('code',[_vm._v("onmessage")]),_vm._v("函数进行线程间通信。")])]),_vm._v(" "),_c('div',{staticClass:"language-js line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-js"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 主线程")]),_vm._v("\nworker"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("postMessage")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("666")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 主线程向worker线程发送消息")]),_vm._v("\nworker"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function-variable function"}},[_vm._v("onmessage")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("function")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token parameter"}},[_vm._v("e")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 监听worker线程的消息")]),_vm._v("\n  console"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("log")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_vm._v("e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// work.js")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("this")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("postMessage")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token number"}},[_vm._v("999")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// worker向主线程发送消息")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("this")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function-variable function"}},[_vm._v("onmessage")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("function")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token parameter"}},[_vm._v("e")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_vm._v(" "),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("{")]),_vm._v("\n  "),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("this")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("data "),_c('span',{pre:true,attrs:{"class":"token operator"}},[_vm._v("=")]),_vm._v(" e"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_vm._v("data"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("}")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("6")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("7")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("8")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("9")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("10")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("11")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("12")]),_c('br')])]),_c('ol',{attrs:{"start":"3"}},[_c('li',[_vm._v("使用完毕，为了节省系统资源，必须关闭 worker 线程。")])]),_vm._v(" "),_c('div',{staticClass:"language-js line-numbers-mode"},[_c('pre',{pre:true,attrs:{"class":"language-js"}},[_c('code',[_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// 主线程")]),_vm._v("\nworker"),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("terminate")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n\n"),_c('span',{pre:true,attrs:{"class":"token comment"}},[_vm._v("// work.js")]),_vm._v("\n"),_c('span',{pre:true,attrs:{"class":"token keyword"}},[_vm._v("this")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(".")]),_c('span',{pre:true,attrs:{"class":"token function"}},[_vm._v("close")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v("(")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(")")]),_c('span',{pre:true,attrs:{"class":"token punctuation"}},[_vm._v(";")]),_vm._v("\n")])]),_vm._v(" "),_c('div',{staticClass:"line-numbers-wrapper"},[_c('span',{staticClass:"line-number"},[_vm._v("1")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("2")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("3")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("4")]),_c('br'),_c('span',{staticClass:"line-number"},[_vm._v("5")]),_c('br')])])]),_vm._v(" "),_c('li',[_c('p',[_vm._v("注意事项")]),_vm._v(" "),_c('ol',[_c('li',[_vm._v("同源限制，分配给 worker 线程的 js 文件必须与主线程的 js 同源。")]),_vm._v(" "),_c('li',[_vm._v("DOM 限制，worker 线程无法操作 DOM，但是可以操作 navigator 和 location。")]),_vm._v(" "),_c('li',[_vm._v("通信限制，worker 线程与主线程是两个不同的全局上下文，不能直接通信，只能通过消息完成。")]),_vm._v(" "),_c('li',[_vm._v("脚本限制，worker 线程不能读取本地文件，只能加载网络脚本。")])])])]),_vm._v(" "),_c('h3',{attrs:{"id":"事件循环"}},[_c('a',{staticClass:"header-anchor",attrs:{"href":"#事件循环"}},[_vm._v("#")]),_vm._v(" 事件循环")]),_vm._v(" "),_c('p',[_vm._v("JS 的任务分为同步任务和异步任务，同步任务在主线程上执行，形成一个"),_c('code',[_vm._v("执行栈")]),_vm._v("，异步任务在其他线程执行，完成之后会将回调函数加入到"),_c('code',[_vm._v("事件队列")]),_vm._v("中，当执行栈清空时，主线程会先读取"),_c('code',[_vm._v("微任务队列")]),_vm._v("并逐一执行，之后 GUI 渲染线程会检查渲染，也代表一个循环结束，接着系统又会从事件队列中读取一个宏任务放到主线程执行，依此循环，就形成了事件循环。")]),_vm._v(" "),_c('ul',[_c('li',[_c('strong',[_vm._v("执行栈")]),_vm._v("：也叫执行上下文栈，JS 引擎在运行时，会先创建一个栈，并默认创建一个全局执行上下文，压入栈底，在调用函数时，会创建函数执行上下文，然后入栈，执行完再被弹出。")]),_vm._v(" "),_c('li',[_c('strong',[_vm._v("事件队列")]),_vm._v("：存放宏任务，比如网络请求回调、定时器回调，由事件触发线程管理，只要异步任务有了结果，就会把回调函数加入到事件队列中。")]),_vm._v(" "),_c('li',[_c('strong',[_vm._v("微任务队列")]),_vm._v("：存放微任务，比如 Promise、nextTick，由全局执行上下文管理，只要 Promise 状态变化，就会把 then 注册的回调函数加入到微任务队列中。同样 nextTick 也是基于 Promise 实现，当操作数据之后，底层会调用 nextTick 加入微任务队列，此时我们再手动调用 nextTick 会追加在队列后面，当执行前一个 nextTick 任务时，会去更新 dom 树，因为 dom 树更新是同步的，所以执行下一个 nextTick 时，dom 树已经更新，只是还未渲染，因为该事件循环还未结束，但是这并不影响我们在下一个 nextTick 中获取 dom 元素，从而达到一个异步效果。")])]),_vm._v(" "),_c('p',[_c('img',{attrs:{"src":"https://img-blog.csdnimg.cn/20200821150047814.png#pic_center","alt":""}})])])}
var staticRenderFns = []


// CONCATENATED MODULE: ./blogs/frontEnd/20210417-js-thread.md?vue&type=template&id=e0b74eec&

// EXTERNAL MODULE: ./node_modules/vue-loader/lib/runtime/componentNormalizer.js
var componentNormalizer = __webpack_require__(10);

// CONCATENATED MODULE: ./blogs/frontEnd/20210417-js-thread.md

var script = {}


/* normalize component */

var component = Object(componentNormalizer["a" /* default */])(
  script,
  render,
  staticRenderFns,
  false,
  null,
  null,
  null
  
)

/* harmony default export */ var _20210417_js_thread = __webpack_exports__["default"] = (component.exports);

/***/ })

}]);